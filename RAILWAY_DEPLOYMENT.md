# üöÇ Railway Deployment Guide

Deploy your AI Code Review Assistant to Railway with just a few clicks!

## üéØ One-Click Deploy

[![Deploy on Railway](https://railway.app/button.svg)](https://railway.app/template/ai-code-review)

## üìã Prerequisites

- Railway account (free tier available)
- GitHub account
- GitHub App credentials (Client ID, Client Secret, Private Key)
- OpenAI or Anthropic API key

## üöÄ Deployment Steps

### Step 1: Deploy to Railway

1. Click the "Deploy on Railway" button above
2. Select your GitHub repository or fork this project
3. Railway will automatically detect all services:
   - **Backend**: Python FastAPI service
   - **Frontend**: React/Vite static site
   - **Database**: PostgreSQL
   - **Cache**: Redis

### Step 2: Configure Environment Variables

Railway will prompt you to set these variables:

#### Backend Service Variables:
```bash
# Required
GITHUB_APP_ID=your_github_app_id
GITHUB_CLIENT_ID=your_github_client_id
GITHUB_CLIENT_SECRET=your_github_client_secret
GITHUB_PRIVATE_KEY=your_github_private_key
GITHUB_WEBHOOK_SECRET=your_webhook_secret
OPENAI_API_KEY=your_openai_api_key  # or ANTHROPIC_API_KEY

# Auto-generated by Railway
DATABASE_URL=${DATABASE_URL}  # Linked from PostgreSQL service
REDIS_URL=${REDIS_URL}        # Linked from Redis service
SECRET_KEY=${SECRET_KEY}      # Auto-generated

# Optional
ANTHROPIC_API_KEY=your_anthropic_api_key
SENTRY_DSN=your_sentry_dsn
ENVIRONMENT=production
```

#### Frontend Service Variables:
```bash
VITE_API_URL=https://your-backend.railway.app
```

### Step 3: Link Services

Railway will automatically link:
- PostgreSQL database to backend
- Redis cache to backend
- Backend API URL to frontend

### Step 4: Deploy

Click **Deploy** and Railway will:
1. Build Docker containers for backend and frontend
2. Run database migrations
3. Start all services
4. Provide public URLs

### Step 5: Configure GitHub Webhook

1. Get your backend URL: `https://your-backend.railway.app`
2. Go to GitHub App settings
3. Set Webhook URL: `https://your-backend.railway.app/api/webhooks/github`
4. Set Webhook Secret (same as GITHUB_WEBHOOK_SECRET)
5. Enable permissions:
   - **Pull requests**: Read & Write
   - **Contents**: Read
   - **Metadata**: Read
6. Subscribe to events:
   - Pull request opened, synchronize, reopened

## üéõÔ∏è Service Configuration

### Backend Service
- **Root Directory**: `backend/`
- **Build Command**: `pip install -r requirements.txt`
- **Start Command**: `gunicorn app.main:app --workers 4 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:$PORT`
- **Health Check**: `/health`
- **Port**: Auto-detected from $PORT

### Frontend Service
- **Root Directory**: `frontend/`
- **Build Command**: `npm install && npm run build`
- **Start Command**: `npx serve -s dist -l $PORT`
- **Static Files**: `dist/`
- **Port**: Auto-detected from $PORT

### Database Service (PostgreSQL)
- **Version**: 15
- **Storage**: 1GB (free tier)
- **Backups**: Automatic daily backups
- **Extensions**: `pg_trgm`, `uuid-ossp`

### Cache Service (Redis)
- **Version**: 7
- **Max Memory**: 100MB (free tier)
- **Eviction Policy**: `allkeys-lru`

## üí∞ Pricing

### Free Tier (Hobby)
- **Cost**: $0/month
- **Resources**: 
  - 512 MB RAM
  - 1 GB Disk
  - Shared CPU
- **Limits**:
  - $5 usage limit
  - 500 hours/month
- **Perfect for**: Development, testing, small projects

### Pro Tier
- **Cost**: $20/month
- **Resources**:
  - 8 GB RAM
  - 100 GB Disk
  - Dedicated CPU
- **Features**:
  - Custom domains
  - Team collaboration
  - Priority support
  - Unlimited hours

## üîß Post-Deployment

### Initialize Database
Railway runs migrations automatically, but you can manually trigger:
```bash
# In Railway CLI or dashboard shell
python backend/init_db.py
python backend/add_indexes.py
```

### Seed Test Data (Optional)
```bash
python backend/seed_test_data.py
```

### Verify Deployment
1. **Backend Health**: `https://your-backend.railway.app/health`
2. **Frontend**: `https://your-frontend.railway.app`
3. **API Docs**: `https://your-backend.railway.app/docs`

## üìä Monitoring

### Railway Dashboard
- **Metrics**: CPU, Memory, Network usage
- **Logs**: Real-time logs from all services
- **Deployments**: History and rollback options
- **Variables**: Manage environment variables

### Sentry Integration (Recommended)
Add Sentry DSN to environment variables for error tracking:
```bash
SENTRY_DSN=https://xxx@xxx.ingest.sentry.io/xxx
```

## üîÑ Continuous Deployment

Railway automatically deploys when you push to your main branch:
1. Push code to GitHub
2. Railway detects changes
3. Builds and deploys automatically
4. Zero-downtime rolling updates

### Manual Deployment
```bash
# Install Railway CLI
npm install -g @railway/cli

# Login
railway login

# Link project
railway link

# Deploy
railway up
```

## üêõ Troubleshooting

### Build Fails
- Check Railway build logs
- Verify `requirements.txt` and `package.json`
- Ensure Docker builds locally first

### Database Connection Issues
- Verify DATABASE_URL is linked
- Check PostgreSQL service status
- Review backend logs for connection errors

### Frontend Can't Reach Backend
- Verify VITE_API_URL points to backend URL
- Check CORS settings in backend
- Ensure backend is deployed and healthy

### GitHub Webhook Fails
- Verify webhook URL is correct
- Check GITHUB_WEBHOOK_SECRET matches
- Review webhook delivery logs in GitHub

## üéì Best Practices

1. **Environment Variables**: Use Railway's built-in secrets
2. **Database Backups**: Enable automatic backups
3. **Monitoring**: Set up health checks and alerts
4. **Scaling**: Use Pro tier for production traffic
5. **Domains**: Add custom domain for professional URLs
6. **Git Branch**: Use separate environments for staging/prod

## üÜò Support

- **Railway Docs**: https://docs.railway.app
- **Discord**: Railway community
- **GitHub Issues**: This project's issues page

## üîó Useful Links

- [Railway Dashboard](https://railway.app/dashboard)
- [Railway CLI Docs](https://docs.railway.app/develop/cli)
- [Railway Pricing](https://railway.app/pricing)
- [Railway Templates](https://railway.app/templates)

---

**Ready to deploy?** Click the button at the top of this file! üöÄ
